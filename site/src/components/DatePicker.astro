---
import fs from 'node:fs';
import path from 'node:path';

interface Props {
  currentDate?: string;
}

const { currentDate } = Astro.props;

// Load manifest for available dates
let dates: string[] = [];
const manifestPath = path.join(process.cwd(), 'public', 'rendered', 'manifest.json');
if (fs.existsSync(manifestPath)) {
  const manifest = JSON.parse(fs.readFileSync(manifestPath, 'utf-8'));
  dates = Object.keys(manifest.dates || {}).sort((a, b) => b.localeCompare(a));
}
---

<div class="date-picker">
  <label for="date-select" class="block text-sm text-muted-foreground mb-1">
    Select date:
  </label>
  <select
    id="date-select"
    class="w-full px-3 py-2 bg-background border border-border rounded-lg text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-ring"
    data-dates={JSON.stringify(dates)}
  >
    {dates.map(date => (
      <option value={date} selected={date === currentDate}>
        {date}
      </option>
    ))}
  </select>
</div>

<script>
  const select = document.getElementById('date-select') as HTMLSelectElement;
  if (select) {
    select.addEventListener('change', () => {
      const date = select.value;
      window.location.href = `/archive/${date}`;
    });
  }
</script>
